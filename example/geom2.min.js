var Geom2=function(r){"use strict";var s=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")};function i(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var a=function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t};var h=function(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t},n=1e-5;var L={EQ_0:function(t){return t<n&&-n<t},EQ:function(t,e){return t-e<n&&-n<t-e},LE:function(t,e){return t-e<=n},GE:function(t,e){return n<=t-e}},_=function(){function o(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;s(this,o),h(this,"x",void 0),h(this,"y",void 0),this.x=t,this.y=e}return a(o,[{key:"set",value:function(t,e){var n=1<arguments.length&&void 0!==e?e:0;return t instanceof o?(this.x=t.x,this.y=t.y):(this.x=t,this.y=n),this}},{key:"addMul",value:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}},{key:"subMul",value:function(t,e){return this.x-=t.x*e,this.y-=t.y*e,this}},{key:"scl",value:function(t,e){var n=1<arguments.length&&void 0!==e?e:t;return this.x*=t,this.y*=n,this}},{key:"add",value:function(t){return this.x+=t.x,this.y+=t.y,this}},{key:"translate",value:function(t,e){return this.x+=t,this.y+=e,this}},{key:"sub",value:function(t){return this.x-=t.x,this.y-=t.y,this}},{key:"perp",value:function(){var t=this.x;return this.x=this.y,this.y=-t,this}},{key:"rotate",value:function(t,e){var n=1<arguments.length&&void 0!==e?e:o.ZERO,r=this.x,i=this.y;return this.x=n.x+(r-n.x)*Math.cos(t)-(i-n.y)*Math.sin(t),this.y=n.y+(r-n.x)*Math.sin(t)+(i-n.y)*Math.cos(t),this}},{key:"angle",value:function(t){return Math.atan2(this.y-t.y,this.x-t.x)}},{key:"reverse",value:function(){return this.x=-this.x,this.y=-this.y,this}},{key:"dot",value:function(t){return this.x*t.x+this.y*t.y}},{key:"dotRef",value:function(t,e){return(this.x-e.x)*(t.x-e.x)+(this.y-e.y)*(t.y-e.y)}},{key:"cross",value:function(t){return this.x*t.y-this.y*t.x}},{key:"crossRef",value:function(t,e){return(this.x-e.x)*(t.y-e.y)-(this.y-e.y)*(t.x-e.x)}},{key:"project",value:function(t){var e=this.dot(t)/t.len2();return this.x=e*t.x,this.y=e*t.y,this}},{key:"projectN",value:function(t){var e=this.dot(t);return this.x=e*t.x,this.y=e*t.y,this}},{key:"reflect",value:function(t){var e=this.x,n=this.y;return this.project(t).scl(2),this.x-=e,this.y-=n,this}},{key:"reflectN",value:function(t){var e=this.x,n=this.y;return this.projectN(t).scl(2),this.x-=e,this.y-=n,this}},{key:"normalize",value:function(){var t=this.len();return 0<t&&(this.x=this.x/t,this.y=this.y/t),this}},{key:"len2",value:function(){return this.x*this.x+this.y*this.y}},{key:"len",value:function(){return Math.sqrt(this.len2())}},{key:"setLen",value:function(t){return this.normalize().scl(t)}},{key:"clone",value:function(){return new o(this.x,this.y)}},{key:"dist2",value:function(t){return(t.x-this.x)*(t.x-this.x)+(t.y-this.y)*(t.y-this.y)}},{key:"dist",value:function(t){return Math.sqrt(this.dist2(t))}},{key:"equalsTo",value:function(t){return L.EQ(this.x,t.x)&&L.EQ(this.y,t.y)}}],[{key:"lerp",value:function(t,e,n){return new o(n*(e.x-t.x)+t.x,n*(e.y-t.y)+t.y)}}]),o}();h(_,"ZERO",new _);for(var u=function(){function i(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:t,r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:e;s(this,i),h(this,"left",void 0),h(this,"right",void 0),h(this,"top",void 0),h(this,"bottom",void 0),this.left=t,this.bottom=e,this.right=n,this.top=r}return a(i,null,[{key:"fromVector",value:function(t){return new i(t.x,t.y)}}]),a(i,[{key:"set",value:function(t){this.left=t.left,this.bottom=t.bottom,this.right=t.right,this.top=t.top}},{key:"getCenter",value:function(){return new _((this.left+this.right)/2,(this.top+this.bottom)/2)}},{key:"intersects",value:function(t){return this.left<=t.right&&this.right>=t.left&&this.bottom<=t.top&&this.top>=t.bottom}},{key:"contains",value:function(t){return this.left<=t.left&&this.right>=t.right&&this.bottom<=t.bottom&&this.top>=t.top}},{key:"merge",value:function(t){return this.left=Math.min(this.left,t.left),this.bottom=Math.min(this.bottom,t.bottom),this.right=Math.max(this.right,t.right),this.top=Math.max(this.top,t.top),this}},{key:"includes",value:function(t){return this.left=Math.min(this.left,t.x),this.bottom=Math.min(this.bottom,t.y),this.right=Math.max(this.right,t.x),this.top=Math.max(this.top,t.y),this}},{key:"isPointIn",value:function(t){return!1}},{key:"toString",value:function(){return"["+this.left+", "+this.bottom+", "+this.right+", "+this.top+"]"}},{key:"getAABB",value:function(){return this}},{key:"getArea",value:function(){return(this.top-this.bottom)*(this.right-this.left)}},{key:"getOrigin",value:function(){return this.getCenter()}},{key:"getCentroid",value:function(){return this.getCenter()}},{key:"centerX",get:function(){return(this.left+this.right)/2}},{key:"centerY",get:function(){return(this.bottom+this.top)/2}},{key:"width",get:function(){return this.right-this.left}},{key:"height",get:function(){return this.top-this.bottom}}],[{key:"fromCenter",value:function(t,e,n){var r=2<arguments.length&&void 0!==n?n:e;return new i(t.x-e/2,t.y-r/2,t.x+e/2,t.y+r/2)}}]),i}(),t=function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new _,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:new Array;s(this,t),h(this,"normal",void 0),h(this,"depth",void 0),h(this,"contacts",void 0),this.normal=e,this.depth=n,this.contacts=r},e=Math.PI,o=2*Math.PI,c={PI:e,PI2:o},k=[],l=0;l<10;l++)k.push(new _);var w,v;new t;function C(t){for(var e,n,r=t.length;0!==r;)n=Math.floor(Math.random()*r),e=t[r-=1],t[r]=t[n],t[n]=e;return t}function f(t,e){return 0<=t&&0<=e||t<0&&e<0}function y(t,e){return(t%e+e)%e}function d(t){return y(t+e,o)-e}function p(t){return y(t,o)}function g(t,e){return p(t-e)}function m(t,e,n){return n.x<=Math.max(t.x,e.x)&&n.x>=Math.min(t.x,e.x)&&n.y<=Math.max(t.y,e.y)&&n.y>=Math.min(t.y,e.y)}function x(t,e,n){return(e.x-t.x)*(n.y-e.y)-(e.y-t.y)*(n.x-e.x)}function M(t,e){var n=t.len2(),r=e.dot(t);return r<0?w.LEFT:n<r?w.RIGHT:w.MIDDLE}function b(t,e,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:.1;return Math.abs(t.dist2(e)-(t.dist2(n)+e.dist2(n)))<=r}function E(t,e,n,r){if(e.equalsTo(n))return void 0!==r&&r.set(e),t.dist(e);var i=k.pop(),o=k.pop(),s=k.pop();if(void 0===i||void 0===o||void 0===s)throw new Error("temp variable memory allocation error");i.set(e).sub(n),o.set(e).sub(t),s.set(n).sub(t);var a,h=i.dot(o),u=-i.dot(s);return a=0<=h&&0<=u?(i.normalize(),void 0!==r&&r.set(e).addMul(i,i.dot(s)),Math.abs(i.cross(s))):h<0?(void 0!==r&&r.set(e),t.dist(e)):(void 0!==r&&r.set(n),t.dist(n)),k.push(i),k.push(o),k.push(s),a}(v=w=w||{})[v.LEFT=-1]="LEFT",v[v.MIDDLE=0]="MIDDLE",v[v.RIGHT=1]="RIGHT";var I=function(){function l(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:c.PI2;s(this,l),h(this,"c",void 0),h(this,"r",void 0),h(this,"startAngle",void 0),h(this,"endAngle",void 0),this.c=t.clone(),this.r=e,this.startAngle=p(n),this.endAngle=p(r)}return a(l,[{key:"clone",value:function(){return new l(this.c.clone(),this.r,this.startAngle,this.endAngle)}},{key:"contains",value:function(t){if(!L.EQ(this.c.dist(t),this.r))return!1;var e=t.angle(this.c);return L.LE(this.startAngle,e)&&L.LE(e,this.endAngle)}},{key:"getAABB",value:function(){var t=this.breakToFunctional().reduce(function(t,e){return t.includes(e.start)},new u(this.start.x,this.start.y));return t=t.includes(this.end)}},{key:"breakToFunctional",value:function(){for(var t=[],e=[0,Math.PI/2,2*Math.PI/2,3*Math.PI/2],n=[this.c.clone().translate(this.r,0),this.c.clone().translate(0,this.r),this.c.clone().translate(-this.r,0),this.c.clone().translate(0,-this.r)],r=[],i=0;i<4;i++)this.contains(n[i])&&r.push(new l(this.c,this.r,this.startAngle,e[i]));if(0==r.length)t.push(this.clone());else{r.sort(function(t,e){return t.length-e.length});for(var o=0;o<r.length;o++){var s=0<t.length?t[t.length-1]:void 0,a=void 0;a=new l(this.c,this.r,s?s.endAngle:this.startAngle,r[o].endAngle),L.EQ_0(a.length)||t.push(a.clone())}var h,u=0<t.length?t[t.length-1]:void 0;h=new l(this.c,this.r,u?u.endAngle:this.startAngle,this.endAngle),L.EQ_0(h.length)||L.EQ(h.sweep,2*Math.PI)||t.push(h.clone())}return t}},{key:"sweep",get:function(){return g(this.endAngle,this.startAngle)}},{key:"start",get:function(){return new _(this.c.x+this.r,this.c.y).rotate(this.startAngle,this.c)}},{key:"end",get:function(){return new _(this.c.x+this.r,this.c.y).rotate(this.endAngle,this.c)}},{key:"vertices",get:function(){return[this.start,this.end]}},{key:"length",get:function(){return Math.abs(this.sweep*this.r)}}]),l}(),P=function(){function t(){s(this,t),h(this,"items",void 0),h(this,"size",void 0),this.items=[],this.size=0}return a(t,[{key:"enqueue",value:function(t){this.items.push(t),this.sink(this.items.length-1)}},{key:"sink",value:function(t){for(var e=this.items[t];0<t&&e.compare(this.items[Math.floor((t-1)/2)]);)this.items[t]=this.items[Math.floor((t-1)/2)],t=Math.floor((t-1)/2);this.items[t]=e}},{key:"dequeue",value:function(){for(var t=this.items[0],e=0;2*e+1<this.items.length;)e=2*e+2>=this.items.length||this.items[2*e+1].compare(this.items[2*e+2])?(this.items[e]=this.items[2*e+1],2*e+1):(this.items[e]=this.items[2*e+2],2*e+2);return e<this.items.length-1&&(this.items[e]=this.items[this.items.length-1],this.sink(e)),this.items.pop(),t}}]),t}();var B,A=(function(t){var e=function(o){var h,t=Object.prototype,u=t.hasOwnProperty,e="function"==typeof Symbol?Symbol:{},i=e.iterator||"@@iterator",n=e.asyncIterator||"@@asyncIterator",r=e.toStringTag||"@@toStringTag";function s(t,e,n,r){var i=e&&e.prototype instanceof a?e:a,o=Object.create(i.prototype),s=new B(r||[]);return o._invoke=function(o,s,a){var h=c;return function(t,e){if(h===f)throw new Error("Generator is already running");if(h===y){if("throw"===t)throw e;return L()}for(a.method=t,a.arg=e;;){var n=a.delegate;if(n){var r=E(n,a);if(r){if(r===d)continue;return r}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if(h===c)throw h=y,a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);h=f;var i=l(o,s,a);if("normal"===i.type){if(h=a.done?y:v,i.arg===d)continue;return{value:i.arg,done:a.done}}"throw"===i.type&&(h=y,a.method="throw",a.arg=i.arg)}}}(t,n,s),o}function l(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}o.wrap=s;var c="suspendedStart",v="suspendedYield",f="executing",y="completed",d={};function a(){}function p(){}function g(){}var m={};m[i]=function(){return this};var x=Object.getPrototypeOf,b=x&&x(x(A([])));b&&b!==t&&u.call(b,i)&&(m=b);var k=g.prototype=a.prototype=Object.create(m);function w(t){["next","throw","return"].forEach(function(e){t[e]=function(t){return this._invoke(e,t)}})}function M(h){var e;this._invoke=function(n,r){function t(){return new Promise(function(t,e){!function e(t,n,r,i){var o=l(h[t],h,n);if("throw"!==o.type){var s=o.arg,a=s.value;return a&&"object"==typeof a&&u.call(a,"__await")?Promise.resolve(a.__await).then(function(t){e("next",t,r,i)},function(t){e("throw",t,r,i)}):Promise.resolve(a).then(function(t){s.value=t,r(s)},function(t){return e("throw",t,r,i)})}i(o.arg)}(n,r,t,e)})}return e=e?e.then(t,t):t()}}function E(t,e){var n=t.iterator[e.method];if(n===h){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=h,E(t,e),"throw"===e.method))return d;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return d}var r=l(n,t.iterator,e.arg);if("throw"===r.type)return e.method="throw",e.arg=r.arg,e.delegate=null,d;var i=r.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=h),e.delegate=null,d):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,d)}function I(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function P(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function B(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(I,this),this.reset(!0)}function A(e){if(e){var t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,r=function t(){for(;++n<e.length;)if(u.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=h,t.done=!0,t};return r.next=r}}return{next:L}}function L(){return{value:h,done:!0}}return p.prototype=k.constructor=g,g.constructor=p,g[r]=p.displayName="GeneratorFunction",o.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===p||"GeneratorFunction"===(e.displayName||e.name))},o.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,g):(t.__proto__=g,r in t||(t[r]="GeneratorFunction")),t.prototype=Object.create(k),t},o.awrap=function(t){return{__await:t}},w(M.prototype),M.prototype[n]=function(){return this},o.AsyncIterator=M,o.async=function(t,e,n,r){var i=new M(s(t,e,n,r));return o.isGeneratorFunction(e)?i:i.next().then(function(t){return t.done?t.value:i.next()})},w(k),k[r]="Generator",k[i]=function(){return this},k.toString=function(){return"[object Generator]"},o.keys=function(n){var r=[];for(var t in n)r.push(t);return r.reverse(),function t(){for(;r.length;){var e=r.pop();if(e in n)return t.value=e,t.done=!1,t}return t.done=!0,t}},o.values=A,B.prototype={constructor:B,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=h,this.done=!1,this.delegate=null,this.method="next",this.arg=h,this.tryEntries.forEach(P),!t)for(var e in this)"t"===e.charAt(0)&&u.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=h)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(n){if(this.done)throw n;var r=this;function t(t,e){return o.type="throw",o.arg=n,r.next=t,e&&(r.method="next",r.arg=h),!!e}for(var e=this.tryEntries.length-1;0<=e;--e){var i=this.tryEntries[e],o=i.completion;if("root"===i.tryLoc)return t("end");if(i.tryLoc<=this.prev){var s=u.call(i,"catchLoc"),a=u.call(i,"finallyLoc");if(s&&a){if(this.prev<i.catchLoc)return t(i.catchLoc,!0);if(this.prev<i.finallyLoc)return t(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return t(i.catchLoc,!0)}else{if(!a)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return t(i.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;0<=n;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&u.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var i=r;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=t,o.arg=e,i?(this.method="next",this.next=i.finallyLoc,d):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),d},finish:function(t){for(var e=this.tryEntries.length-1;0<=e;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),P(n),d}},catch:function(t){for(var e=this.tryEntries.length-1;0<=e;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var i=r.arg;P(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:A(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=h),d}},o}(t.exports);try{regeneratorRuntime=e}catch(t){Function("r","regeneratorRuntime = r")(e)}}(B={exports:{}},B.exports),B.exports),O=function(){function e(t){s(this,e),h(this,"data",void 0),h(this,"next",void 0),h(this,"prev",void 0),this.data=t,this.next=null,this.prev=null}return a(e,[{key:"hasPrev",value:function(){return null!==this.prev}},{key:"hasNext",value:function(){return null!==this.next}}]),e}(),N=function(){function t(){s(this,t),h(this,"length",void 0),h(this,"head",void 0),this.length=0,this.head=null}return a(t,[{key:"isEmpty",value:function(){return null===this.head}},{key:"start",value:function(){return null===this.head?null:this.head.data}},{key:"push",value:function(t){var e=new O(t);return this.head?(e.prev=this.head.prev,e.next=this.head,this.head.prev.next=e,this.head.prev=e):((this.head=e).prev=e).next=e,this.length++,e}},{key:"insertAfter",value:function(t,e){var n=new O(e);return n.prev=t,n.next=t.next,t.next.prev=n,t.next=n,this.length++,n}},{key:"last",value:function(){return this.head?this.head.prev:void 0}},{key:"values",value:A.mark(function t(){var e;return A.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(null!==(e=this.head))return t.next=4,e.data;t.next=10;break;case 4:if(e.next!==this.head)return e=e.next,t.next=8,e.data;t.next=10;break;case 8:t.next=4;break;case 10:case"end":return t.stop()}},t,this)})}]),t}(),R=new _;function F(t,e,n){var r=t.getFarthestPointInDirection(n),i=e.getFarthestPointInDirection(R.set(n).reverse());return r.sub(i)}function T(t,e){var n,r,i,o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:[new _,new _,new _],s=0,a=new _,h=new _,u=new _,l=new _,c=new _,v=new _;if(v.set(t.getOrigin()).sub(e.getOrigin()),0==v.x&&0==v.y&&(v.x=1),(n=o[0].set(F(t,e,v))).dot(v)<=0)return!1;for(v.set(n).reverse();;){if((n=o[++s].set(F(t,e,v))).dot(v)<=0)return!1;if(a.set(n).reverse(),s<2)r=o[0],h.set(r).sub(n),D(h,a,h,v),0==v.len2()&&v.set(h).perp();else{if(r=o[1],i=o[0],h.set(r).sub(n),u.set(i).sub(n),D(h,u,u,c),0<=c.dot(a))v.set(c);else{if(D(u,h,h,l),l.dot(a)<0)return!0;o[0].set(o[1]),v.set(l)}o[1].set(o[2]),--s}}}function D(t,e,n,r){var i=t.x*n.x+t.y*n.y,o=e.x*n.x+e.y*n.y;return r.x=e.x*i-t.x*o,r.y=e.y*i-t.y*o,r}var S=function(){function n(t,e){s(this,n),this.startVertex=t,this.distance=e}return a(n,[{key:"compare",value:function(t){return this.distance<t.distance}}]),n}();function G(t,e){return-t.cross(t.clone().sub(e))/Math.sqrt(t.dist2(e))}function j(t,e,n,r){var i=new N,o=new P,s=new _;if(n[1].crossRef(n[2],n[0])<0){var a=n[1];n[1]=n[2],n[2]=a}for(var h=0;h<n.length;h++){var u=i.push(n[h]),l=G(n[h],n[(h+1)%3]);o.enqueue(new S(u,l))}for(;;){var c=!0,v=!1,f=void 0;try{for(var y,d=o.items[Symbol.iterator]();!(c=(y=d.next()).done);c=!0)y.value}catch(t){v=!0,f=t}finally{try{c||null==d.return||d.return()}finally{if(v)throw f}}var p=o.dequeue(),g=p.startVertex,m=p.distance,x=g.data,b=g.next.data.clone().sub(x);D(g.prev.data.clone().sub(x),b,b,s);var k=F(t,e,s);if(!(1e-4<k.cross(b)/b.len()-m))return r.normal=s.normalize(),void(r.depth=m);var w=i.insertAfter(g,k);o.enqueue(new S(w.prev,G(w.prev.data,w.data))),o.enqueue(new S(w,G(w.data,w.next.data)))}}var z;function q(t,e,n){var r,i,o,s,a=n.normal;n.depth;r=t.getFarthestEdgeInDirection(a),i=e.getFarthestEdgeInDirection(a.clone().reverse()),Math.abs(r.dot(a))<=Math.abs(i.dot(a))?(o=r,s=i):(s=r,o=i);var h=s.v1.dotRef(o.v2,o.v1),u=s.v2.dotRef(o.v2,o.v1);if(u<h){var l=h;h=u,u=l;var c=s.v1;s.v1=s.v2,s.v2=c}var v,f,y=-h/(u-h),d=(o.len2()-h)/(u-h);v=0<y&&y<1?s.lerp(y):s.v1.clone(),f=0<d&&d<1?s.lerp(d):s.v2.clone();var p,g,m=v.crossRef(o.v2,o.v1),x=f.crossRef(o.v2,o.v1);if(m<=.01)g=x<=.01?(p=v,f):p=v;else{if(!(x<=.01))return console.log(t),console.log(e),console.log(n),void console.log("error: impossible poc situation");g=p=f}if(p===g)n.contacts.push(p);else{for(var b=0;b<.999;b+=.25)n.contacts.push(_.lerp(p,g,b));n.contacts.push(g)}}(z=r.VORONOI_REGION||(r.VORONOI_REGION={}))[z.LEFT=0]="LEFT",z[z.UP=1]="UP",z[z.DOWN=2]="DOWN",z[z.RIGHT=3]="RIGHT";function V(t,e){s(this,V),h(this,"aabb",void 0),h(this,"data",void 0),this.aabb=t,this.data=e}var Y=function(){function n(t,e){s(this,n),h(this,"v1",void 0),h(this,"v2",void 0),this.v1=t,this.v2=e}return a(n,[{key:"getAABB",value:function(){return new u(Math.min(this.v1.x,this.v2.x),Math.min(this.v1.y,this.v2.y),Math.max(this.v1.x,this.v2.x),Math.max(this.v1.y,this.v2.y))}},{key:"contains",value:function(t){return b(this.v1,this.v2,t,1)}},{key:"dot",value:function(t){return(this.v2.x-this.v1.x)*t.x+(this.v2.y-this.v1.y)*t.y}},{key:"voronoiRegion",value:function(t){var e=this.len2(),n=t.dotRef(this.v2,this.v1);return n<0?r.VORONOI_REGION.LEFT:e<n?r.VORONOI_REGION.RIGHT:t.crossRef(this.v2,this.v1)<0?r.VORONOI_REGION.UP:r.VORONOI_REGION.DOWN}},{key:"len2",value:function(){return this.v2.dist2(this.v1)}},{key:"lerp",value:function(t){return _.lerp(this.v1,this.v2,t)}}]),n}(),H=new _,Q=function(){function n(t,e){s(this,n),h(this,"c",void 0),h(this,"r",void 0),this.c=t,this.r=e}return a(n,[{key:"intersects",value:function(t,e){var n=[new _,new _,new _],r=T(this,t,n);return e&&r?(j(this,t,n,e),q(this,t,e),!0):r}},{key:"getAABB",value:function(){return new u(this.c.x-this.r,this.c.y-this.r,this.c.x+this.r,this.c.y+this.r)}},{key:"isPointIn",value:function(t){return t.dist(this.c)<=this.r}},{key:"getArea",value:function(){return this.r*this.r*Math.PI}},{key:"getOrigin",value:function(){return this.c}},{key:"getCentroid",value:function(){return this.c}},{key:"getFarthestPointInDirection",value:function(t){return t.clone().setLen(this.r).add(this.c)}},{key:"getFarthestEdgeInDirection",value:function(t){return H.set(t).normalize(),new Y(H.clone().perp().scl(.01*this.r).addMul(H,this.r).add(this.c),H.clone().perp().scl(.01*-this.r).addMul(H,this.r).add(this.c))}}]),n}(),X=function(){function e(t){s(this,e),h(this,"cost",1),h(this,"sint",0),h(this,"_pos",new _),t instanceof e?(this.cost=t.cost,this.sint=t.sint,this._pos.x=t._pos.x,this._pos.y=t._pos.y):t instanceof _?(this.cost=1,this.sint=0,this._pos.x=t.x,this._pos.y=t.y):(this.cost=1,this.sint=0,this._pos.x=0,this._pos.y=0)}return a(e,[{key:"rotate",value:function(t,e,n){var r=Math.cos(t),i=Math.sin(t),o=r*this.cost-i*this.sint,s=i*this.cost+r*this.sint;this.cost=o,this.sint=s;var a=this._pos.x-e,h=this._pos.y-n;this._pos.x=r*a-i*h+e,this._pos.y=i*a+r*h+n}},{key:"translate",value:function(t,e){this._pos.x+=t,this._pos.y+=e}},{key:"transform",value:function(t,e){var n=t.x,r=t.y;return e.x=this.cost*n-this.sint*r+this._pos.x,e.y=this.sint*n+this.cost*r+this._pos.y,e}},{key:"inverseTransform",value:function(t,e){var n=t.x-this._pos.x,r=t.y-this._pos.y;return e.x=this.cost*n+this.sint*r,e.y=-this.sint*n+this.cost*r,e}},{key:"angle",set:function(t){this.cost=Math.cos(t),this.sint=Math.sin(t)}},{key:"position",set:function(t){this._pos.set(t)},get:function(){return this._pos}},{key:"x",get:function(){return this._pos.x}},{key:"y",get:function(){return this._pos.y}}]),e}(),U=new _,W=function(){function n(t,e){s(this,n),h(this,"transform",void 0),h(this,"points",void 0),h(this,"calcPoints",void 0),this.transform=new X(t),this.points=e,this.calcPoints=new Array,this.recalc()}return a(n,[{key:"rotate",value:function(t){for(var e=0;e<this.points.length;e++)this.points[e].rotate(t)}},{key:"translate",value:function(t,e){for(var n=this.points,r=n.length,i=0;i<r;i++)n[i].x+=t,n[i].y+=e;return this}},{key:"recalc",value:function(){if(this.points.length!==this.calcPoints.length){for(;this.points.length<this.calcPoints.length;)this.calcPoints.pop();for(;this.points.length>this.calcPoints.length;)this.calcPoints.push(new _)}var t,e=this.points,n=e.length;for(t=0;t<n;t++)this.transform.transform(e[t],this.calcPoints[t]);return this}},{key:"getOrigin",value:function(){return this.transform.position}},{key:"getCentroid",value:function(){for(var t=this.calcPoints,e=t.length,n=0,r=0,i=0,o=0;o<e;o++){var s=t[o],a=o===e-1?t[0]:t[o+1],h=s.x*a.y-a.x*s.y;n+=(s.x+a.x)*h,r+=(s.y+a.y)*h,i+=h}return new _(n/=i*=3,r/=i)}},{key:"intersects",value:function(t,e){var n=[new _,new _,new _],r=T(this,t,n);return e&&r?(j(this,t,n,e),q(this,t,e),!0):r}},{key:"isPointIn",value:function(t){var e,n=this.calcPoints,r=n.length,i=!1;for(e=0;e<r;e++)n[e].y>t.y!=n[(e+1)%r].y>t.y&&t.x<(n[(e+1)%r].x-n[e].x)*(t.y-n[e].y)/(n[(e+1)%r].y-n[e].y)+n[e].x&&(i=!i);if(i)return!0;for(e=0;e<r;e++){if(b(n[e],n[(e+1)%r],t,1))return!0}return!1}},{key:"getAABB",value:function(){return n.getAABBFromPoints(this.points)}},{key:"getCalcAABB",value:function(){return n.getAABBFromPoints(this.calcPoints)}},{key:"getArea",value:function(){for(var t=this.points,e=t.length,n=0,r=0;r<e;r++){var i=t[r],o=r===e-1?t[0]:t[r+1];n+=i.x*o.y-o.x*i.y}return n/2}},{key:"toCanvasDraw",value:function(t){var e=0<arguments.length&&void 0!==t?t:1,n=this.points,r=n.length,i="ctx.beginPath();\n";i+='ctx.strokeStyle = "black";\n',i+="ctx.moveTo("+(n[0].x+this.transform.x)*e+","+(n[0].y+this.transform.y)*e+");\n";for(var o=1;o<r;o++)i+="ctx.lineTo("+(n[o].x+this.transform.x)*e+","+(n[o].y+this.transform.y)*e+");\n";return i+="ctx.lineTo("+(n[0].x+this.transform.x)*e+","+(n[0].y+this.transform.y)*e+");\n",i+="ctx.stroke();"}},{key:"getFarthestIndexInDirection",value:function(t){var e=this.calcPoints;U.set(e[0]).sub(this.transform.position);for(var n=t.dot(U),r=0,i=1;i<e.length;i++){U.set(e[i]).sub(this.transform.position);var o=t.dot(U);n<o&&(n=o,r=i)}return r}},{key:"getFarthestPointInDirection",value:function(t){return this.calcPoints[this.getFarthestIndexInDirection(t)].clone()}},{key:"getFarthestEdgeInDirection",value:function(t){var e=this.calcPoints,n=this.getFarthestIndexInDirection(t),r=e[(n-1+e.length)%e.length],i=e[n],o=e[(n+1)%e.length],s=i.clone().sub(r).normalize();return i.clone().sub(o).normalize().dot(t)<s.dot(t)?new Y(i,o):new Y(r,i)}},{key:"recenter",value:function(){var t=this.getCentroid(),e=!0,n=!1,r=void 0;try{for(var i,o=this.points[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){i.value.sub(t)}}catch(t){n=!0,r=t}finally{try{e||null==o.return||o.return()}finally{if(n)throw r}}this.transform.translate(t.x,t.y),this.recalc()}},{key:"originPoints",get:function(){return this.points}}],[{key:"fromAABB",value:function(t){return new n(t.getCenter(),[new _(-t.width/2,-t.height/2),new _(t.width/2,-t.height/2),new _(t.width/2,t.height/2),new _(-t.width/2,t.height/2)])}},{key:"getAABBFromPoints",value:function(t){for(var e=t.length,n=t[0].x,r=t[0].y,i=t[0].x,o=t[0].y,s=1;s<e;s++){var a=t[s];a.x<n?n=a.x:a.x>i&&(i=a.x),a.y<r?r=a.y:a.y>o&&(o=a.y)}return new u(n,r,i,o)}}]),n}(),Z=function(){function i(t,e,n,r){s(this,i),h(this,"children",void 0),h(this,"baseBound",void 0),h(this,"count",void 0),h(this,"looseBound",void 0),h(this,"elements",void 0),this.children=null,this.baseBound=new u(t,e,n,r),this.looseBound=new u(0,0,0,0),this.elements=[],this.count=0}return a(i,[{key:"extendLooseBound",value:function(t){0<this.count&&t.merge(this.looseBound)}},{key:"contains",value:function(t){return 0<this.count&&this.looseBound.contains(t)}},{key:"intersects",value:function(t){return 0<this.count&&t.intersects(this.looseBound)}},{key:"getRegion",value:function(t){var e=0;return t.centerX>this.baseBound.centerX&&(e+=2),t.centerY>this.baseBound.centerY&&(e+=1),e}},{key:"addElement",value:function(t){this.elements.push(t),1==this.elements.length&&this.looseBound.set(t.aabb),this.looseBound.merge(t.aabb)}},{key:"recalcBound",value:function(){if(null===this.children){if(0<this.elementCount){this.looseBound.set(this.elements[0].aabb);for(var t=1;t<this.elements.length;t++)this.looseBound.merge(this.elements[t].aabb)}}else for(var e=0;e<3;e++)this.children[e].extendLooseBound(this.looseBound)}},{key:"getElements",value:function(){return this.elements}},{key:"removeElement",value:function(t){for(var e=0;e<this.elements.length;e++)if(t===this.elements[e])return this.elements.splice(e,1),!0;return!1}},{key:"clearElements",value:function(){this.elements.length=0}},{key:"toString",value:function(t){for(var e=0<arguments.length&&void 0!==t?t:0,n="",r="",i=0;i<e;i++)r+=" ";if(n+=r+"count: "+this.count+"\n",n+=r+"baseBound: "+this.baseBound+"\n",n+=r+"looseBound: "+this.looseBound+"\n",null===this.children){n+=r+"element: \n";var o=!0,s=!1,a=void 0;try{for(var h,u=this.elements[Symbol.iterator]();!(o=(h=u.next()).done);o=!0){var l=h.value;n+=r+"  "+l.aabb+" id: "+l.data.getId()+"\n"}}catch(t){s=!0,a=t}finally{try{o||null==u.return||u.return()}finally{if(s)throw a}}}else for(var c=0;c<4;c++)n+=r+"node"+c+":\n"+this.children[c].toString(e+2);return n}},{key:"toCanvasParameter",value:function(t){return t.left+", "+t.bottom+", "+(t.right-t.left)+", "+(t.top-t.bottom)}},{key:"toCanvasDraw",value:function(){var t="";if(t+="ctx.beginPath();",t+='ctx.strokeStyle = "green";\n',t+="ctx.rect("+this.toCanvasParameter(this.baseBound)+");\n",t+="ctx.stroke();\n",0<this.count&&(t+="ctx.beginPath();",t+='ctx.strokeStyle = "blue";\n',t+="ctx.rect("+this.toCanvasParameter(this.looseBound)+");\n",t+="ctx.stroke();\n"),null===this.children){t+="ctx.beginPath();",t+='ctx.strokeStyle = "red";\n';var e=!0,n=!1,r=void 0;try{for(var i,o=this.elements[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var s=i.value;t+="ctx.rect("+this.toCanvasParameter(s.aabb)+");\n"}}catch(t){n=!0,r=t}finally{try{e||null==o.return||o.return()}finally{if(n)throw r}}t+="ctx.stroke();\n"}else for(var a=0;a<4;a++)t+=this.children[a].toCanvasDraw();return t}},{key:"elementCount",get:function(){return this.elements.length}}]),i}(),J=function(){function i(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:4,r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:10;s(this,i),h(this,"maxChildren",void 0),h(this,"maxLayer",void 0),h(this,"root",void 0),h(this,"elementMap",void 0),this.root=new Z(0,0,t,e),this.elementMap=new Map,this.maxChildren=n,this.maxLayer=r}return a(i,[{key:"insert",value:function(t,e){var n=new V(t,e);this.insertNode(this.root,n,0),this.elementMap.set(e.getId(),n)}},{key:"insertNode",value:function(t,e,n){if(null===t.children)t.addElement(e),t.elementCount>this.maxChildren&&n<this.maxLayer&&this.split(t,n+1);else{var r=t.getRegion(e.aabb);this.insertNode(t.children[r],e,n+1),t.looseBound.merge(e.aabb)}t.count++}},{key:"split",value:function(t,e){var n=!0,r=!(t.children=[new Z(t.baseBound.left,t.baseBound.bottom,t.baseBound.centerX,t.baseBound.centerY),new Z(t.baseBound.left,t.baseBound.centerY,t.baseBound.centerX,t.baseBound.top),new Z(t.baseBound.centerX,t.baseBound.bottom,t.baseBound.right,t.baseBound.centerY),new Z(t.baseBound.centerX,t.baseBound.centerY,t.baseBound.right,t.baseBound.top)]),i=void 0;try{for(var o,s=t.getElements()[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var a=o.value,h=t.getRegion(a.aabb);t.children[h].addElement(a),t.children[h].count++,t.children[h].elementCount>this.maxChildren&&e<this.maxLayer&&this.split(t.children[h],e+1)}}catch(t){r=!0,i=t}finally{try{n||null==s.return||s.return()}finally{if(r)throw i}}t.clearElements()}},{key:"delete",value:function(t){var e=this.elementMap.get(t.getId());return void 0!==e&&(!!this.deleteInNode(this.root,e)&&(this.elementMap.delete(t.getId()),!0))}},{key:"deleteInNode",value:function(t,e){if(null===t.children)return!!t.removeElement(e)&&(t.count--,t.recalcBound(),!0);var n=t.getRegion(e.aabb),r=this.deleteInNode(t.children[n],e);return r&&(t.count--,0<t.count?t.recalcBound():t.children=null),r}},{key:"getAll",value:function(t,e){return this.searchNode(this.root,t,function(t){return e.push(t),!1}),e}},{key:"search",value:function(t,e){this.searchNode(this.root,t,e)}},{key:"searchNode",value:function(t,e,n){if(null===t.children){var r=!0,i=!1,o=void 0;try{for(var s,a=t.getElements()[Symbol.iterator]();!(r=(s=a.next()).done);r=!0){var h=s.value;if(e.intersects(h.aabb)&&n(h.data))return!0}}catch(t){i=!0,o=t}finally{try{r||null==a.return||a.return()}finally{if(i)throw o}}}else for(var u=0;u<4;u++){if(t.children[u].intersects(e))if(this.searchNode(t.children[u],e,n))return!0}return!1}},{key:"toString",value:function(){return this.root.toString(0)}},{key:"toCanvasDraw",value:function(){return'const canvas = document.getElementById("canvas")\n','const ctx = canvas.getContext("2d");\n','const canvas = document.getElementById("canvas")\nconst ctx = canvas.getContext("2d");\n'+this.root.toCanvasDraw()}}]),i}();function K(t,e){return t.x<e.x?-1:t.x>e.x?1:t.y<e.y?-1:t.y>e.y?1:0}function $(t,e,n,r){e.velocity.addMul(n,t.invMass),e.angularVelocity+=t.invInertia*r.cross(n)}return r.AABB=u,r.Arc=I,r.Circle=Q,r.CollisionResult=t,r.Comparator=L,r.Geom2Const=c,r.LQTree=J,r.Polygon=W,r.Segment=Y,r.Transform=X,r.Vector=_,r.angleDiff=function(t,e){return d(t-e)},r.angleDiffPI2=g,r.angleNormalize=d,r.angleNormalizePI2=p,r.applyImpulse=$,r.crossProduct3=x,r.epa=j,r.generateRandomConvexPolygon=function(t,e){void 0===e&&(e=1);for(var n=[],r=[],i=0;i<t;i++)n.push(Math.random()),r.push(Math.random());n.sort(),r.sort();for(var o=n[0],s=n[t-1],a=r[0],h=r[t-1],u=[],l=[],c=o,v=o,f=1;f<t-1;f++){var y=n[f];Math.random()<.5?(u.push(y-c),c=y):(u.push(v-y),v=y)}u.push(s-c),u.push(v-s);for(var d=a,p=a,g=1;g<t-1;g++){var m=r[g];Math.random()<.5?(l.push(m-d),d=m):(l.push(p-m),p=m)}l.push(h-d),l.push(p-h),C(l);for(var x=[],b=0;b<t;b++)x.push(new _(u[b],l[b]));x.sort(function(t,e){return Math.atan2(t.y,t.x)-Math.atan2(e.y,e.x)});for(var k=0,w=0,M=0,E=0,I=[],P=0;P<t;P++)I.push(new _(k,w)),k+=x[P].x,w+=x[P].y,M=Math.min(M,k),E=Math.min(E,w);var B=o-M,A=a-E;I.forEach(function(t){t.x+=B-.5,t.y+=A-.5,t.x*=e,t.y*=e});var L=new W(new _,I),O=L.getAABB();return L.translate(-O.centerX,-O.centerY),L},r.gjk=T,r.isConvex=function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:t.length-e,r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:1e-5;if(n<4)return!0;var i=void 0;t[e].x===t[n-1].x&&t[e].y===t[n-1].y&&n--;for(var o=0;o<n;o++){var s=e+(o+1)%n,a=e+(o+2)%n,h=x(t[o],t[s],t[a]);if(Math.abs(h)>r)if(void 0===i)i=0<h;else if(i!=0<h)return!1}return!0},r.lineHasPoint=b,r.lineIntersection=function(t,e,n,r){var i=((r.x-n.x)*(t.y-n.y)-(r.y-n.y)*(t.x-n.x))/((r.y-n.y)*(e.x-t.x)-(r.x-n.x)*(e.y-t.y));return new _(t.x+i*(e.x-t.x),t.y+i*(e.y-t.y))},r.makeHull=function(t){var e=t.slice();return e.sort(K),function(t){if(t.length<=1)return t.slice();for(var e=[],n=0;n<t.length;n++){for(var r=t[n];2<=e.length;){var i=e[e.length-1],o=e[e.length-2];if(!((i.x-o.x)*(r.y-o.y)>=(i.y-o.y)*(r.x-o.x)))break;e.pop()}e.push(r)}e.pop();for(var s=[],a=t.length-1;0<=a;a--){for(var h=t[a];2<=s.length;){var u=s[s.length-1],l=s[s.length-2];if(!((u.x-l.x)*(h.y-l.y)>=(u.y-l.y)*(h.x-l.x)))break;s.pop()}s.push(h)}return s.pop(),1==e.length&&1==s.length&&e[0].x==s[0].x&&e[0].y==s[0].y?e:e.concat(s)}(e)},r.onSegment=m,r.orientation=function(t,e){return x(t.v1,t.v2,e)},r.originDistance=G,r.pMod=y,r.point2polygon=function(t,e,n){var r=e.length,i=k.pop(),o=Number.POSITIVE_INFINITY;if(void 0===i)throw new Error("temp variable memory allocation error");for(var s=0;s<r;s++){var a=(s+1)%r,h=E(t,e[s],e[a],i);h<o&&(o=h,void 0!==n&&n.set(i))}return k.push(i),o},r.point2segment=E,r.positionalCorrection=function(t,e,n){var r=n.normal.clone();r.scl(Math.max(n.depth-.01,0)/(t.invMass+e.invMass)*.2),t.position.subMul(r,t.invMass),e.position.addMul(r,e.invMass)},r.resolveContact=function(t,e,n,r,i){var o=new _,s=new _,a=Math.min(t.restitution,n.restitution),h=Math.sqrt(t.staticFriction*n.staticFriction),u=Math.sqrt(t.dynamicFriction*n.dynamicFriction),l=e.velocity.clone(),c=r.velocity.clone(),v=e.angularVelocity,f=r.angularVelocity,y=!0,d=!1,p=void 0;try{for(var g,m=i.contacts[Symbol.iterator]();!(y=(g=m.next()).done);y=!0){var x=g.value,b=x.clone().sub(e.position),k=x.clone().sub(r.position);o.set(c).addMul(k,f).sub(l).subMul(b,v);var w=o.dot(i.normal);if(!(0<w)){var M=b.cross(i.normal),E=k.cross(i.normal),I=t.invMass+n.invMass+M*M*t.invInertia+E*E*n.invInertia,P=-(1+a)*w;P/=I,P/=i.contacts.length,s.set(i.normal).scl(P),$(n,r,s,k),$(t,e,s.reverse(),b),o.set(c).addMul(k,f).sub(l).subMul(b,v);var B=o.clone().subMul(i.normal,o.dot(i.normal));B.normalize();var A=-o.dot(B);A/=I,A/=i.contacts.length,L.EQ(A,0)||(Math.abs(A)<P*h?s.set(B).scl(A):s.set(B).scl(-P*u),$(n,r,s,k),$(t,e,s.reverse(),b))}}}catch(t){d=!0,p=t}finally{try{y||null==m.return||m.return()}finally{if(d)throw p}}},r.resolvePointsOfContact=q,r.sameSign=f,r.shuffle=C,r.support=F,r.testCircleCircle=function(t,e,n){var r=k.pop();if(void 0===r)throw new Error("memory allocation error");r.set(e.c).sub(t.c);var i=t.r+e.r,o=i*i,s=r.len2();if(o<s)return k.push(r),!1;if(n){var a=Math.sqrt(s);n.depth=i-a,n.normal.set(r.normalize()),t.r<=e.r?n.contacts.push(n.normal.clone().scl(t.r).add(t.c)):n.contacts.push(n.normal.clone().scl(-e.r).add(e.c))}return k.push(r),!0},r.testPolygonCircle=function(t,e,n){var r=k.pop();if(void 0===r)throw new Error("memory allocation error");r.set(e.c);var i=e.r,o=t.calcPoints,s=o.length,a=k.pop(),h=k.pop();if(void 0===h||void 0===a)throw new Error("memory allocation error");for(var u=0;u<s;u++){var l=(u+1)%s,c=(u-1+s)%s,v=0,f=null;a.set(t.calcPoints[l]).sub(t.calcPoints[u]),h.set(r).sub(o[u]),n&&h.len2();var y=M(a,h);if(y===w.LEFT){a.set(t.calcPoints[u]).sub(t.calcPoints[c]);var d=k.pop();if(void 0===d)throw new Error("memory allocation error");if(d.set(r).sub(o[c]),(y=M(a,d))===w.RIGHT){var p=h.len();if(i<p)return k.push(r),k.push(a),k.push(h),k.push(d),!1;n&&(f=h.normalize(),v=i-p)}k.push(d)}else if(y===w.RIGHT){if(a.set(t.calcPoints[(1+l)%s]).sub(t.calcPoints[l]),h.set(r).sub(o[l]),(y=M(a,h))===w.LEFT){var g=h.len();if(i<g)return k.push(r),k.push(a),k.push(h),!1;n&&(f=h.normalize(),v=i-g)}}else{var m=a.perp().normalize(),x=h.dot(m),b=Math.abs(x);if(0<x&&i<b)return k.push(r),k.push(m),k.push(h),!1;n&&(f=m,v=i-x)}f&&n&&Math.abs(v)<Math.abs(n.depth)&&(n.depth=v,n.normal.set(f))}return k.push(r),k.push(a),k.push(h),!0},r.testSegmentSegment=function(t,e,n,r){var i=x(t,e,n),o=x(t,e,r),s=x(n,r,t),a=x(n,r,e);return!f(i,o)&&!f(s,a)||(!(0!=i||!m(t,n,e))||(!(0!=o||!m(t,r,e))||(!(0!=s||!m(n,t,r))||!(0!=a||!m(n,e,r)))))},r.tripleProduct=D,r}({});
