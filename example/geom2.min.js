var Geom2=function(t){"use strict";function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function h(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}function a(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var n=1e-5;var c={EQ_0:function(t){return t<n&&-n<t},EQ:function(t,e){return t-e<n&&-n<t-e},LE:function(t,e){return t-e<=n},GE:function(t,e){return n<=t-e}},T=function(){function s(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;o(this,s),a(this,"x",void 0),a(this,"y",void 0),this.x=t,this.y=e}return h(s,[{key:"set",value:function(t,e){var n=1<arguments.length&&void 0!==e?e:0;return t instanceof s?(this.x=t.x,this.y=t.y):(this.x=t,this.y=n),this}},{key:"addMul",value:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}},{key:"subMul",value:function(t,e){return this.x-=t.x*e,this.y-=t.y*e,this}},{key:"scl",value:function(t,e){var n=1<arguments.length&&void 0!==e?e:t;return this.x*=t,this.y*=n,this}},{key:"add",value:function(t){return this.x+=t.x,this.y+=t.y,this}},{key:"translate",value:function(t,e){return this.x+=t,this.y+=e,this}},{key:"sub",value:function(t){return this.x-=t.x,this.y-=t.y,this}},{key:"perp",value:function(){var t=this.x;return this.x=this.y,this.y=-t,this}},{key:"rotate",value:function(t,e){var n=1<arguments.length&&void 0!==e?e:s.ZERO,i=this.x,r=this.y;return this.x=n.x+(i-n.x)*Math.cos(t)-(r-n.y)*Math.sin(t),this.y=n.y+(i-n.x)*Math.sin(t)+(r-n.y)*Math.cos(t),this}},{key:"angle",value:function(t){return Math.atan2(this.y-t.y,this.x-t.x)}},{key:"reverse",value:function(){return this.x=-this.x,this.y=-this.y,this}},{key:"dot",value:function(t){return this.x*t.x+this.y*t.y}},{key:"dotRef",value:function(t,e){return(this.x-e.x)*(t.x-e.x)+(this.y-e.y)*(t.y-e.y)}},{key:"cross",value:function(t){return this.x*t.y-this.y*t.x}},{key:"crossRef",value:function(t,e){return(this.x-e.x)*(t.y-e.y)-(this.y-e.y)*(t.x-e.x)}},{key:"project",value:function(t){var e=this.dot(t)/t.len2();return this.x=e*t.x,this.y=e*t.y,this}},{key:"projectN",value:function(t){var e=this.dot(t);return this.x=e*t.x,this.y=e*t.y,this}},{key:"reflect",value:function(t){var e=this.x,n=this.y;return this.project(t).scl(2),this.x-=e,this.y-=n,this}},{key:"reflectN",value:function(t){var e=this.x,n=this.y;return this.projectN(t).scl(2),this.x-=e,this.y-=n,this}},{key:"normalize",value:function(){var t=this.len();return 0<t&&(this.x=this.x/t,this.y=this.y/t),this}},{key:"len2",value:function(){return this.x*this.x+this.y*this.y}},{key:"len",value:function(){return Math.sqrt(this.len2())}},{key:"setLen",value:function(t){return this.normalize().scl(t)}},{key:"clone",value:function(){return new s(this.x,this.y)}},{key:"dist2",value:function(t){return(t.x-this.x)*(t.x-this.x)+(t.y-this.y)*(t.y-this.y)}},{key:"dist",value:function(t){return Math.sqrt(this.dist2(t))}},{key:"equalsTo",value:function(t){return c.EQ(this.x,t.x)&&c.EQ(this.y,t.y)}}]),s}();a(T,"ZERO",new T);for(var u=function(){function r(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:t,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:e;o(this,r),a(this,"left",void 0),a(this,"right",void 0),a(this,"top",void 0),a(this,"bottom",void 0),this.left=t,this.bottom=e,this.right=n,this.top=i}return h(r,null,[{key:"fromVector",value:function(t){return new r(t.x,t.y)}}]),h(r,[{key:"set",value:function(t){this.left=t.left,this.bottom=t.bottom,this.right=t.right,this.top=t.top}},{key:"getCenter",value:function(){return new T((this.left+this.right)/2,(this.top+this.bottom)/2)}},{key:"intersects",value:function(t,e){if(t instanceof r)return this.left<=t.right&&this.right>=t.left&&this.bottom<=t.top&&this.top>=t.bottom;throw new Error("shape intersects unavailable")}},{key:"contains",value:function(t){return this.left<=t.left&&this.right>=t.right&&this.bottom<=t.bottom&&this.top>=t.top}},{key:"merge",value:function(t){return this.left=Math.min(this.left,t.left),this.bottom=Math.min(this.bottom,t.bottom),this.right=Math.max(this.right,t.right),this.top=Math.max(this.top,t.top),this}},{key:"includes",value:function(t){return this.left=Math.min(this.left,t.x),this.bottom=Math.min(this.bottom,t.y),this.right=Math.max(this.right,t.x),this.top=Math.max(this.top,t.y),this}},{key:"isPointIn",value:function(t){return!1}},{key:"toString",value:function(){return"["+this.left+", "+this.bottom+", "+this.right+", "+this.top+"]"}},{key:"getAABB",value:function(){return this}},{key:"centerX",get:function(){return(this.left+this.right)/2}},{key:"centerY",get:function(){return(this.bottom+this.top)/2}}],[{key:"fromCenter",value:function(t,e,n){var i=2<arguments.length&&void 0!==n?n:e;return new r(t.x-e/2,t.y-i/2,t.x+e/2,t.y+i/2)}}]),r}(),e=function t(){o(this,t),a(this,"overlapN",void 0),a(this,"overlapV",void 0),a(this,"aInB",void 0),a(this,"bInA",void 0),a(this,"overlap",void 0),this.overlapN=new T,this.overlapV=new T,this.aInB=!0,this.bInA=!0,this.overlap=Number.MAX_VALUE},r=Math.PI,s=2*Math.PI,v={PI:r,PI2:s},w=[],l=0;l<10;l++)w.push(new T);for(var x=[],f=0;f<5;f++)x.push([]);var M,y;new e;function L(t){for(var e,n,i=t.length;0!==i;)n=Math.floor(Math.random()*i),e=t[i-=1],t[i]=t[n],t[n]=e;return t}function d(t,e){return 0<=t&&0<=e||t<0&&e<0}function p(t,e){return(t%e+e)%e}function g(t){return p(t+r,s)-r}function m(t){return p(t,s)}function b(t,e){return m(t-e)}function k(t,e,n){return n.x<=Math.max(t.x,e.x)&&n.x>=Math.min(t.x,e.x)&&n.y<=Math.max(t.y,e.y)&&n.y>=Math.min(t.y,e.y)}function B(t,e,n){return(e.x-t.x)*(n.y-e.y)-(e.y-t.y)*(n.x-e.x)}function E(t,e,n){for(var i=Number.MAX_VALUE,r=-Number.MAX_VALUE,s=t.length,o=0;o<s;o++){var h=t[o].dot(e);h<i&&(i=h),r<h&&(r=h)}n[0]=i,n[1]=r}function I(t,e,n,i,r,s){var o=x.pop(),h=x.pop(),a=w.pop();if(void 0===o||void 0===h||void 0===a)throw new Error("memory allocation error");a.set(e).sub(t);var u=a.dot(r);if(E(n,r,o),E(i,r,h),h[0]+=u,h[1]+=u,o[0]>h[1]||h[0]>o[1])return w.push(a),x.push(o),x.push(h),!0;if(s){var l=0;if(o[0]<h[0])if(s.aInB=!1,o[1]<h[1])l=o[1]-h[0],s.bInA=!1;else{var c=o[1]-h[0],v=h[1]-o[0];l=c<v?c:-v}else if(s.bInA=!1,o[1]>h[1])l=o[0]-h[1],s.aInB=!1;else{var f=o[1]-h[0],y=h[1]-o[0];l=f<y?f:-y}var d=Math.abs(l);d<s.overlap&&(s.overlap=d,s.overlapN.set(r),l<0&&s.overlapN.reverse())}return w.push(a),x.push(o),x.push(h),!1}function A(t,e,n){var i=w.pop();if(void 0===i)throw new Error("memory allocation error");i.set(e.c).sub(t.c);var r=t.r+e.r,s=r*r,o=i.len2();if(s<o)return w.push(i),!1;if(n){var h=Math.sqrt(o);n.overlap=r-h,n.overlapN.set(i.normalize()),n.overlapV.set(i).scl(n.overlap),n.aInB=t.r<=e.r&&h<=e.r-t.r,n.bInA=e.r<=t.r&&h<=t.r-e.r}return w.push(i),!0}function P(t,e,n){for(var i=t.calcPoints,r=i.length,s=e.calcPoints,o=s.length,h=0;h<r;h++){var a=w.pop();if(void 0===a)throw new Error("memory allocation error");if(a.set(i[(h+1)%r]).sub(i[h]).perp().normalize(),I(T.ZERO,T.ZERO,i,s,a,n))return w.push(a),!1;w.push(a)}for(var u=0;u<o;u++){var l=w.pop();if(void 0===l)throw new Error("memory allocation error");if(l.set(s[(u+1)%o]).sub(s[u]).perp().normalize(),I(T.ZERO,T.ZERO,i,s,l,n))return w.push(l),!1;w.push(l)}return n&&n.overlapV.set(n.overlapN).scl(n.overlap),!0}function C(t,e){var n=t.len2(),i=e.dot(t);return i<0?M.LEFT:n<i?M.RIGHT:M.MIDDLE}function N(t,e,n){var i=w.pop();if(void 0===i)throw new Error("memory allocation error");i.set(e.c);var r=e.r,s=r*r,o=t.calcPoints,h=o.length,a=w.pop(),u=w.pop();if(void 0===u||void 0===a)throw new Error("memory allocation error");for(var l=0;l<h;l++){var c=(l+1)%h,v=(l-1+h)%h,f=0,y=null;a.set(t.calcPoints[c]).sub(t.calcPoints[l]),u.set(i).sub(o[l]),n&&u.len2()>s&&(n.aInB=!1);var d=C(a,u);if(d===M.LEFT){a.set(t.calcPoints[l]).sub(t.calcPoints[v]);var x=w.pop();if(void 0===x)throw new Error("memory allocation error");if(x.set(i).sub(o[v]),(d=C(a,x))===M.RIGHT){var p=u.len();if(r<p)return w.push(i),w.push(a),w.push(u),w.push(x),!1;n&&(n.bInA=!1,y=u.normalize(),f=r-p)}w.push(x)}else if(d===M.RIGHT){if(a.set(t.calcPoints[(1+c)%h]).sub(t.calcPoints[c]),u.set(i).sub(o[c]),(d=C(a,u))===M.LEFT){var g=u.len();if(r<g)return w.push(i),w.push(a),w.push(u),!1;n&&(n.bInA=!1,y=u.normalize(),f=r-g)}}else{var m=a.perp().normalize(),b=u.dot(m),k=Math.abs(b);if(0<b&&r<k)return w.push(i),w.push(m),w.push(u),!1;n&&(y=m,f=r-b,(0<=b||f<2*r)&&(n.bInA=!1))}y&&n&&Math.abs(f)<Math.abs(n.overlap)&&(n.overlap=f,n.overlapN.set(y))}return n&&n.overlapV.set(n.overlapN).scl(n.overlap),w.push(i),w.push(a),w.push(u),!0}function S(t,e,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:.1;return Math.abs(t.dist2(e)-(t.dist2(n)+e.dist2(n)))<=i}function R(t,e,n,i){if(e.equalsTo(n))return void 0!==i&&i.set(e),t.dist(e);var r=w.pop(),s=w.pop(),o=w.pop();if(void 0===r||void 0===s||void 0===o)throw new Error("temp variable memory allocation error");r.set(e).sub(n),s.set(e).sub(t),o.set(n).sub(t);var h,a=r.dot(s),u=-r.dot(o);return h=0<=a&&0<=u?(r.normalize(),void 0!==i&&i.set(e).addMul(r,r.dot(o)),Math.abs(r.cross(o))):a<0?(void 0!==i&&i.set(e),t.dist(e)):(void 0!==i&&i.set(n),t.dist(n)),w.push(r),w.push(s),w.push(o),h}(y=M=M||{})[y.LEFT=-1]="LEFT",y[y.MIDDLE=0]="MIDDLE",y[y.RIGHT=1]="RIGHT";function D(t,e){o(this,D),a(this,"aabb",void 0),a(this,"data",void 0),this.aabb=t,this.data=e}var V=function(){function l(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:v.PI2;o(this,l),a(this,"c",void 0),a(this,"r",void 0),a(this,"startAngle",void 0),a(this,"endAngle",void 0),this.c=t.clone(),this.r=e,this.startAngle=m(n),this.endAngle=m(i)}return h(l,[{key:"clone",value:function(){return new l(this.c.clone(),this.r,this.startAngle,this.endAngle)}},{key:"contains",value:function(t){if(!c.EQ(this.c.dist(t),this.r))return!1;var e=t.angle(this.c);return c.LE(this.startAngle,e)&&c.LE(e,this.endAngle)}},{key:"getAABB",value:function(){var t=this.breakToFunctional().reduce(function(t,e){return t.includes(e.start)},new u(this.start.x,this.start.y));return t=t.includes(this.end)}},{key:"breakToFunctional",value:function(){for(var t=[],e=[0,Math.PI/2,2*Math.PI/2,3*Math.PI/2],n=[this.c.clone().translate(this.r,0),this.c.clone().translate(0,this.r),this.c.clone().translate(-this.r,0),this.c.clone().translate(0,-this.r)],i=[],r=0;r<4;r++)this.contains(n[r])&&i.push(new l(this.c,this.r,this.startAngle,e[r]));if(0==i.length)t.push(this.clone());else{i.sort(function(t,e){return t.length-e.length});for(var s=0;s<i.length;s++){var o=0<t.length?t[t.length-1]:void 0,h=void 0;h=new l(this.c,this.r,o?o.endAngle:this.startAngle,i[s].endAngle),c.EQ_0(h.length)||t.push(h.clone())}var a,u=0<t.length?t[t.length-1]:void 0;a=new l(this.c,this.r,u?u.endAngle:this.startAngle,this.endAngle),c.EQ_0(a.length)||c.EQ(a.sweep,2*Math.PI)||t.push(a.clone())}return t}},{key:"sweep",get:function(){return b(this.endAngle,this.startAngle)}},{key:"start",get:function(){return new T(this.c.x+this.r,this.c.y).rotate(this.startAngle,this.c)}},{key:"end",get:function(){return new T(this.c.x+this.r,this.c.y).rotate(this.endAngle,this.c)}},{key:"vertices",get:function(){return[this.start,this.end]}},{key:"length",get:function(){return Math.abs(this.sweep*this.r)}}]),l}(),z=function(){function e(t){o(this,e),a(this,"cost",1),a(this,"sint",0),a(this,"x",0),a(this,"y",0),t instanceof e?(this.cost=t.cost,this.sint=t.sint,this.x=t.x,this.y=t.y):t instanceof T?(this.cost=1,this.sint=0,this.x=t.x,this.y=t.y):(this.cost=1,this.sint=0,this.x=0,this.y=0)}return h(e,[{key:"rotate",value:function(t,e,n){var i=Math.cos(t),r=Math.sin(t),s=i*this.cost-r*this.sint,o=r*this.cost+i*this.sint;this.cost=s,this.sint=o;var h=this.x-e,a=this.y-n;this.x=i*h-r*a+e,this.y=r*h+i*a+n}},{key:"translate",value:function(t,e){this.x+=t,this.y+=e}},{key:"transform",value:function(t,e){var n=t.x,i=t.y;return e.x=this.cost*n-this.sint*i+this.x,e.y=this.sint*n+this.cost*i+this.y,e}},{key:"inverseTransform",value:function(t,e){var n=t.x-this.x,i=t.y-this.y;return e.x=this.cost*n+this.sint*i,e.y=-this.sint*n+this.cost*i,e}},{key:"angle",set:function(t){this.cost=Math.cos(t),this.sint=Math.sin(t)}},{key:"position",set:function(t){this.x=t.x,this.y=t.y}}]),e}(),X=function(){function n(t,e){o(this,n),a(this,"transform",void 0),a(this,"points",void 0),a(this,"calcPoints",void 0),this.transform=new z(t),this.points=e,this.calcPoints=new Array,this.recalc()}return h(n,[{key:"rotate",value:function(t){for(var e=0;e<this.points.length;e++)this.points[e].rotate(t)}},{key:"translate",value:function(t,e){for(var n=this.points,i=n.length,r=0;r<i;r++)n[r].x+=t,n[r].y+=e;return this}},{key:"recalc",value:function(){if(this.points.length!==this.calcPoints.length){for(;this.points.length<this.calcPoints.length;)this.calcPoints.pop();for(;this.points.length>this.calcPoints.length;)this.calcPoints.push(new T)}var t,e=this.points,n=e.length;for(t=0;t<n;t++)this.transform.transform(e[t],this.calcPoints[t]);return this}},{key:"getCentroid",value:function(){for(var t=this.points,e=t.length,n=0,i=0,r=0,s=0;s<e;s++){var o=t[s],h=s===e-1?t[0]:t[s+1],a=o.x*h.y-h.x*o.y;n+=(o.x+h.x)*a,i+=(o.y+h.y)*a,r+=a}return new T(n/=r*=3,i/=r)}},{key:"intersects",value:function(t,e){if(t instanceof n)return P(this,t,e);if(t instanceof O)return N(this,t,e);throw new Error("shape intersects unavailable")}},{key:"isPointIn",value:function(t){var e,n=this.calcPoints,i=n.length,r=!1;for(e=0;e<i;e++)n[e].y>t.y!=n[(e+1)%i].y>t.y&&t.x<(n[(e+1)%i].x-n[e].x)*(t.y-n[e].y)/(n[(e+1)%i].y-n[e].y)+n[e].x&&(r=!r);if(r)return!0;for(e=0;e<i;e++){if(S(n[e],n[(e+1)%i],t,1))return!0}return!1}},{key:"getAABB",value:function(){for(var t=this.points,e=t.length,n=t[0].x,i=t[0].y,r=t[0].x,s=t[0].y,o=1;o<e;o++){var h=t[o];h.x<n?n=h.x:h.x>r&&(r=h.x),h.y<i?i=h.y:h.y>s&&(s=h.y)}return new u(n,i,r,s)}},{key:"toCanvasDraw",value:function(t){var e=0<arguments.length&&void 0!==t?t:1,n=this.points,i=n.length,r="ctx.beginPath();\n";r+='ctx.strokeStyle = "black";\n',r+="ctx.moveTo("+(n[0].x+this.transform.x)*e+","+(n[0].y+this.transform.y)*e+");\n";for(var s=1;s<i;s++)r+="ctx.lineTo("+(n[s].x+this.transform.x)*e+","+(n[s].y+this.transform.y)*e+");\n";return r+="ctx.lineTo("+(n[0].x+this.transform.x)*e+","+(n[0].y+this.transform.y)*e+");\n",r+="ctx.stroke();"}},{key:"originPoints",get:function(){return this.points}}]),n}(),O=function(){function r(t,e){o(this,r),a(this,"c",void 0),a(this,"r",void 0),this.c=t,this.r=e}return h(r,[{key:"intersects",value:function(t,e){if(t instanceof X){var n=N(t,this,e),i=e.aInB;return e.aInB=e.bInA,e.bInA=i,e.overlapN.reverse(),e.overlapV.reverse(),n}return t instanceof r&&A(this,t,e)}},{key:"getAABB",value:function(){return new u(this.c.x-this.r,this.c.y-this.r,this.c.x+this.r,this.c.y+this.r)}},{key:"isPointIn",value:function(t){return t.dist(this.c)<=this.r}}]),r}(),Q=function(){function n(t,e){o(this,n),a(this,"v1",void 0),a(this,"v2",void 0),this.v1=t,this.v2=e}return h(n,[{key:"getAABB",value:function(){return new u(Math.min(this.v1.x,this.v2.x),Math.min(this.v1.y,this.v2.y),Math.max(this.v1.x,this.v2.x),Math.max(this.v1.y,this.v2.y))}},{key:"contains",value:function(t){return S(this.v1,this.v2,t,1)}}]),n}(),Y=function(){function r(t,e,n,i){o(this,r),a(this,"children",void 0),a(this,"baseBound",void 0),a(this,"count",void 0),a(this,"looseBound",void 0),a(this,"elements",void 0),this.children=null,this.baseBound=new u(t,e,n,i),this.looseBound=new u(0,0,0,0),this.elements=[],this.count=0}return h(r,[{key:"extendLooseBound",value:function(t){0<this.count&&t.merge(this.looseBound)}},{key:"contains",value:function(t){return 0<this.count&&this.looseBound.contains(t)}},{key:"intersects",value:function(t){return 0<this.count&&t.intersects(this.looseBound)}},{key:"getRegion",value:function(t){var e=0;return t.centerX>this.baseBound.centerX&&(e+=2),t.centerY>this.baseBound.centerY&&(e+=1),e}},{key:"addElement",value:function(t){this.elements.push(t),1==this.elements.length&&this.looseBound.set(t.aabb),this.looseBound.merge(t.aabb)}},{key:"recalcBound",value:function(){if(null===this.children){if(0<this.elementCount){this.looseBound.set(this.elements[0].aabb);for(var t=1;t<this.elements.length;t++)this.looseBound.merge(this.elements[t].aabb)}}else for(var e=0;e<3;e++)this.children[e].extendLooseBound(this.looseBound)}},{key:"getElements",value:function(){return this.elements}},{key:"removeElement",value:function(t){for(var e=0;e<this.elements.length;e++)if(t===this.elements[e])return this.elements.splice(e,1),!0;return!1}},{key:"clearElements",value:function(){this.elements.length=0}},{key:"toString",value:function(t){for(var e=0<arguments.length&&void 0!==t?t:0,n="",i="",r=0;r<e;r++)i+=" ";if(n+=i+"count: "+this.count+"\n",n+=i+"baseBound: "+this.baseBound+"\n",n+=i+"looseBound: "+this.looseBound+"\n",null===this.children){n+=i+"element: \n";var s=!0,o=!1,h=void 0;try{for(var a,u=this.elements[Symbol.iterator]();!(s=(a=u.next()).done);s=!0){var l=a.value;n+=i+"  "+l.aabb+" id: "+l.data.getId()+"\n"}}catch(t){o=!0,h=t}finally{try{s||null==u.return||u.return()}finally{if(o)throw h}}}else for(var c=0;c<4;c++)n+=i+"node"+c+":\n"+this.children[c].toString(e+2);return n}},{key:"toCanvasParameter",value:function(t){return t.left+", "+t.bottom+", "+(t.right-t.left)+", "+(t.top-t.bottom)}},{key:"toCanvasDraw",value:function(){var t="";if(t+="ctx.beginPath();",t+='ctx.strokeStyle = "green";\n',t+="ctx.rect("+this.toCanvasParameter(this.baseBound)+");\n",t+="ctx.stroke();\n",0<this.count&&(t+="ctx.beginPath();",t+='ctx.strokeStyle = "blue";\n',t+="ctx.rect("+this.toCanvasParameter(this.looseBound)+");\n",t+="ctx.stroke();\n"),null===this.children){t+="ctx.beginPath();",t+='ctx.strokeStyle = "red";\n';var e=!0,n=!1,i=void 0;try{for(var r,s=this.elements[Symbol.iterator]();!(e=(r=s.next()).done);e=!0){var o=r.value;t+="ctx.rect("+this.toCanvasParameter(o.aabb)+");\n"}}catch(t){n=!0,i=t}finally{try{e||null==s.return||s.return()}finally{if(n)throw i}}t+="ctx.stroke();\n"}else for(var h=0;h<4;h++)t+=this.children[h].toCanvasDraw();return t}},{key:"elementCount",get:function(){return this.elements.length}}]),r}(),F=function(){function r(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:4,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:10;o(this,r),a(this,"maxChildren",void 0),a(this,"maxLayer",void 0),a(this,"root",void 0),a(this,"elementMap",void 0),this.root=new Y(0,0,t,e),this.elementMap=new Map,this.maxChildren=n,this.maxLayer=i}return h(r,[{key:"insert",value:function(t,e){var n=new D(t,e);this.insertNode(this.root,n,0),this.elementMap.set(e.getId(),n)}},{key:"insertNode",value:function(t,e,n){if(null===t.children)t.addElement(e),t.elementCount>this.maxChildren&&n<this.maxLayer&&this.split(t,n+1);else{var i=t.getRegion(e.aabb);this.insertNode(t.children[i],e,n+1)}t.count++}},{key:"split",value:function(t,e){var n=!0,i=!(t.children=[new Y(t.baseBound.left,t.baseBound.bottom,t.baseBound.centerX,t.baseBound.centerY),new Y(t.baseBound.left,t.baseBound.centerY,t.baseBound.centerX,t.baseBound.top),new Y(t.baseBound.centerX,t.baseBound.bottom,t.baseBound.right,t.baseBound.centerY),new Y(t.baseBound.centerX,t.baseBound.centerY,t.baseBound.right,t.baseBound.top)]),r=void 0;try{for(var s,o=t.getElements()[Symbol.iterator]();!(n=(s=o.next()).done);n=!0){var h=s.value,a=t.getRegion(h.aabb);t.children[a].addElement(h),t.children[a].count++,t.children[a].elementCount>this.maxChildren&&e<this.maxLayer&&this.split(t.children[a],e+1)}}catch(t){i=!0,r=t}finally{try{n||null==o.return||o.return()}finally{if(i)throw r}}t.clearElements()}},{key:"delete",value:function(t){var e=this.elementMap.get(t.getId());return void 0!==e&&(!!this.deleteInNode(this.root,e)&&(this.elementMap.delete(t.getId()),!0))}},{key:"deleteInNode",value:function(t,e){if(null===t.children)return!!t.removeElement(e)&&(t.count--,t.recalcBound(),!0);var n=t.getRegion(e.aabb),i=this.deleteInNode(t.children[n],e);return i&&(t.count--,0<t.count?t.recalcBound():t.children=null),i}},{key:"getAll",value:function(t,e){return this.searchNode(this.root,t,function(t){return e.push(t),!1}),e}},{key:"search",value:function(t,e){this.searchNode(this.root,t,e)}},{key:"searchNode",value:function(t,e,n){if(null===t.children){var i=!0,r=!1,s=void 0;try{for(var o,h=t.getElements()[Symbol.iterator]();!(i=(o=h.next()).done);i=!0){var a=o.value;if(e.intersects(a.aabb)&&n(a.data))return!0}}catch(t){r=!0,s=t}finally{try{i||null==h.return||h.return()}finally{if(r)throw s}}}else for(var u=0;u<4;u++){if(t.children[u].intersects(e))if(this.searchNode(t.children[u],e,n))return!0}return!1}},{key:"toString",value:function(){return this.root.toString(0)}},{key:"toCanvasDraw",value:function(){return'const canvas = document.getElementById("canvas")\n','const ctx = canvas.getContext("2d");\n','const canvas = document.getElementById("canvas")\nconst ctx = canvas.getContext("2d");\n'+this.root.toCanvasDraw()}}]),r}();function G(t,e){return t.x<e.x?-1:t.x>e.x?1:t.y<e.y?-1:t.y>e.y?1:0}return t.AABB=u,t.Arc=V,t.Circle=O,t.Comparator=c,t.Geom2Const=v,t.LQTree=F,t.Polygon=X,t.Segment=Q,t.TestResult=e,t.Transform=z,t.Vector=T,t.angleDiff=function(t,e){return g(t-e)},t.angleDiffPI2=b,t.angleNormalize=g,t.angleNormalizePI2=m,t.crossProduct3=B,t.generateRandomConvexPolygon=function(t,e){void 0===e&&(e=1);for(var n=[],i=[],r=0;r<t;r++)n.push(Math.random()),i.push(Math.random());n.sort(),i.sort();for(var s=n[0],o=n[t-1],h=i[0],a=i[t-1],u=[],l=[],c=s,v=s,f=1;f<t-1;f++){var y=n[f];Math.random()<.5?(u.push(y-c),c=y):(u.push(v-y),v=y)}u.push(o-c),u.push(v-o);for(var d=h,x=h,p=1;p<t-1;p++){var g=i[p];Math.random()<.5?(l.push(g-d),d=g):(l.push(x-g),x=g)}l.push(a-d),l.push(x-a),L(l);for(var m=[],b=0;b<t;b++)m.push(new T(u[b],l[b]));m.sort(function(t,e){return Math.atan2(t.y,t.x)-Math.atan2(e.y,e.x)});for(var k=0,w=0,M=0,B=0,E=[],I=0;I<t;I++)E.push(new T(k,w)),k+=m[I].x,w+=m[I].y,M=Math.min(M,k),B=Math.min(B,w);var A=s-M,P=h-B;E.forEach(function(t){t.x+=A-.5,t.y+=P-.5,t.x*=e,t.y*=e});var C=new X(new T,E),N=C.getAABB();return C.translate(-N.centerX,-N.centerY),C},t.isConvex=function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:t.length-e,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:1e-5;if(n<4)return!0;var r=void 0;t[e].x===t[n-1].x&&t[e].y===t[n-1].y&&n--;for(var s=0;s<n;s++){var o=e+(s+1)%n,h=e+(s+2)%n,a=B(t[s],t[o],t[h]);if(Math.abs(a)>i)if(void 0===r)r=0<a;else if(r!=0<a)return!1}return!0},t.isSeparatingAxis=I,t.lineHasPoint=S,t.lineIntersection=function(t,e,n,i){var r=((i.x-n.x)*(t.y-n.y)-(i.y-n.y)*(t.x-n.x))/((i.y-n.y)*(e.x-t.x)-(i.x-n.x)*(e.y-t.y));return new T(t.x+r*(e.x-t.x),t.y+r*(e.y-t.y))},t.makeHull=function(t){var e=t.slice();return e.sort(G),function(t){if(t.length<=1)return t.slice();for(var e=[],n=0;n<t.length;n++){for(var i=t[n];2<=e.length;){var r=e[e.length-1],s=e[e.length-2];if(!((r.x-s.x)*(i.y-s.y)>=(r.y-s.y)*(i.x-s.x)))break;e.pop()}e.push(i)}e.pop();for(var o=[],h=t.length-1;0<=h;h--){for(var a=t[h];2<=o.length;){var u=o[o.length-1],l=o[o.length-2];if(!((u.x-l.x)*(a.y-l.y)>=(u.y-l.y)*(a.x-l.x)))break;o.pop()}o.push(a)}return o.pop(),1==e.length&&1==o.length&&e[0].x==o[0].x&&e[0].y==o[0].y?e:e.concat(o)}(e)},t.onSegment=k,t.orientation=function(t,e){return B(t.v1,t.v2,e)},t.pMod=p,t.point2polygon=function(t,e,n){var i=e.length,r=w.pop(),s=Number.POSITIVE_INFINITY;if(void 0===r)throw new Error("temp variable memory allocation error");for(var o=0;o<i;o++){var h=(o+1)%i,a=R(t,e[o],e[h],r);a<s&&(s=a,void 0!==n&&n.set(r))}return w.push(r),s},t.point2segment=R,t.sameSign=d,t.shuffle=L,t.testCircleCircle=A,t.testPolygonCircle=N,t.testPolygonPolygon=P,t.testSegmentSegment=function(t,e,n,i){var r=B(t,e,n),s=B(t,e,i),o=B(n,i,t),h=B(n,i,e);return!d(r,s)&&!d(o,h)||(!(0!=r||!k(t,n,e))||(!(0!=s||!k(t,i,e))||(!(0!=o||!k(n,t,i))||!(0!=h||!k(n,e,i)))))},t}({});
